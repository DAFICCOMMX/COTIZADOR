<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cotizador DAFIC</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
  /* --- ESTILOS GENERALES (LUJO) --- */
  :root {
    --bg-color: #e6e6e6;
    --text-main: #333;
    --text-light: #777;
    --shadow-light: #ffffff;
    --shadow-dark: #c3c3c3;
    --accent-color: #000;
  }

  body {
    background-color: var(--bg-color);
    margin: 0;
    font-family: 'Montserrat', sans-serif; /* FUENTE NUEVA */
    color: var(--text-main);
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
  }

  /* Scrollbar Personalizado */
  ::-webkit-scrollbar { width: 10px; }
  ::-webkit-scrollbar-track { background: var(--bg-color); }
  ::-webkit-scrollbar-thumb { background: #bbb; border-radius: 5px; }
  ::-webkit-scrollbar-thumb:hover { background: #999; }
  
  .dafic-pricing-container {
    max-width: 1100px;
    margin: 0 auto;
    text-align: center;
    padding: 80px 20px;
    background-color: var(--bg-color); 
    min-height: 100vh;
  }

  /* LOGO CON EFECTO DE ENTRADA */
  .dafic-logo-wrapper {
    margin-bottom: 50px;
    animation: fadeInDown 1.2s cubic-bezier(0.23, 1, 0.32, 1);
  }
  .dafic-logo-img {
    max-width: 260px;
    height: auto;
    display: block;
    margin: 0 auto;
    filter: drop-shadow(5px 10px 15px rgba(163,177,198,0.3));
    transition: transform 0.5s ease;
  }
  .dafic-logo-img:hover { transform: scale(1.02); }

  /* NAVEGACIÃ“N (SOFT UI) */
  .dafic-toggle-wrapper {
    display: inline-flex;
    background-color: var(--bg-color);
    border-radius: 60px;
    padding: 8px;
    margin-bottom: 60px;
    gap: 20px;
    /* Sombra interna profunda para mayor realismo */
    box-shadow: inset 6px 6px 12px var(--shadow-dark), 
                inset -6px -6px 12px var(--shadow-light);
    animation: fadeIn 1.5s ease;
  }
  
  .dafic-toggle-btn {
    padding: 15px 35px;
    background: transparent;
    border: none;
    cursor: pointer;
    font-family: 'Montserrat', sans-serif;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 1px;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    outline: none;
    color: var(--text-light);
    border-radius: 50px;
    text-transform: uppercase;
  }
  
  .dafic-toggle-btn:hover { color: var(--text-main); transform: translateY(-1px); }
  
  .dafic-toggle-btn.active {
    color: var(--accent-color);
    background-color: var(--bg-color);
    box-shadow:  6px 6px 12px var(--shadow-dark), 
                -6px -6px 12px var(--shadow-light);
    transform: scale(1.05);
  }

  .selection-instruction {
    font-size: 15px; color: #999; margin-top: 50px; font-weight: 400; letter-spacing: 1px; 
    animation: pulse 3s infinite ease-in-out;
  }

  /* GRID TARJETAS */
  .dafic-cards-grid {
    display: flex; justify-content: center; gap: 35px; flex-wrap: wrap; margin-bottom: 70px;
  }
  
  .dafic-card {
    background-color: var(--bg-color);
    border-radius: 30px;
    padding: 40px 30px;
    width: 250px;
    text-align: left;
    cursor: pointer;
    position: relative;
    user-select: none;
    border: 1px solid rgba(255,255,255,0.4);
    
    /* Sombra suave inicial */
    box-shadow:  10px 10px 20px var(--shadow-dark), 
                -10px -10px 20px var(--shadow-light);
    
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    opacity: 0;
    animation: fadeInUp 0.8s forwards;
  }
  
  /* AnimaciÃ³n Escalonada */
  .dafic-card:nth-child(1) { animation-delay: 0.1s; }
  .dafic-card:nth-child(2) { animation-delay: 0.2s; }
  .dafic-card:nth-child(3) { animation-delay: 0.3s; }
  .dafic-card:nth-child(4) { animation-delay: 0.4s; }

  /* Efecto Hover: FLOTAR */
  .dafic-card:hover {
    transform: translateY(-8px);
    box-shadow:  18px 18px 30px var(--shadow-dark), 
                -18px -18px 30px var(--shadow-light);
  }
  
  /* Efecto Selected: HUNDIRSE */
  .dafic-card.selected {
    box-shadow: inset 6px 6px 12px var(--shadow-dark), 
                inset -6px -6px 12px var(--shadow-light);
    border-color: transparent;
    transform: scale(0.98);
  }
  
  .card-check-icon {
    position: absolute; top: 30px; right: 30px; width: 26px; height: 26px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s;
    background: var(--bg-color);
    box-shadow:  3px 3px 6px var(--shadow-dark), -3px -3px 6px var(--shadow-light);
  }
  
  .dafic-card.selected .card-check-icon {
    background: var(--bg-color);
    color: var(--accent-color);
    box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
  }
  .dafic-card.selected .card-check-icon::after { content: "âœ“"; font-size: 14px; font-weight: 800; }

  .card-title { font-size: 13px; font-weight: 700; margin: 10px 0 15px 0; text-transform: uppercase; letter-spacing: 1.5px; color: #888; }
  .card-price-range { font-size: 26px; font-weight: 800; color: #222; display: block; margin-bottom: 15px; letter-spacing: -1px; }
  .card-desc { font-size: 13px; color: #666; line-height: 1.7; font-weight: 400; }

  /* SECCION CALCULADORA */
  .calculator-section {
    background-color: var(--bg-color);
    border-radius: 40px;
    padding: 60px;
    max-width: 850px;
    margin: 0 auto;
    text-align: left;
    display: none;
    box-shadow:  20px 20px 60px var(--shadow-dark), 
                -20px -20px 60px var(--shadow-light);
    animation: slideUpFade 0.8s cubic-bezier(0.23, 1, 0.32, 1);
  }
  
  .calc-header { margin-bottom: 40px; font-size: 24px; font-weight: 300; color: #333; border-bottom: 1px solid #d1d1d1; padding-bottom: 20px; }
  .calc-header strong { font-weight: 800; }

  /* TOGGLES OPCIONES */
  .calc-option-card {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 30px; padding: 25px 30px; border-radius: 25px;
    background-color: var(--bg-color); cursor: pointer; transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.4);
    box-shadow: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
  }
  .calc-option-card:hover { transform: translateY(-3px); box-shadow: 12px 12px 20px var(--shadow-dark), -12px -12px 20px var(--shadow-light); }
  .calc-option-card.active {
    box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
    background-color: var(--bg-color); border-color: transparent; transform: translateY(2px);
  }

  .option-indicator {
    width: 26px; height: 26px; border-radius: 50%; background: var(--bg-color);
    box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
    display: flex; align-items: center; justify-content: center; margin-right: 25px; transition: all 0.3s; color: transparent;
  }
  .calc-option-card.active .option-indicator {
    background: var(--bg-color); color: #000;
    box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
  }
  .calc-option-card.active .option-indicator::after { content: "âœ“"; font-size: 14px; font-weight: 800; }

  .option-title { display: block; font-size: 16px; font-weight: 700; color: #333; margin-bottom: 5px; }
  .option-subtitle { font-size: 13px; color: #888; font-weight: 400; }
  .option-price { font-size: 20px; font-weight: 700; color: #333; }

  /* CONTROLES NUMÃ‰RICOS */
  .qty-control {
    display: flex; align-items: center; background: var(--bg-color); border-radius: 30px;
    padding: 6px; margin-left: 20px; visibility: hidden; opacity: 0; transition: all 0.3s;
    box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
  }
  .qty-control.visible { visibility: visible; opacity: 1; }
  .qty-btn {
    background: var(--bg-color); border: none; width: 35px; height: 35px; border-radius: 50%;
    font-size: 18px; cursor: pointer; color: #333;
    box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
    transition: all 0.2s; display: flex; align-items: center; justify-content: center;
  }
  .qty-btn:hover { transform: scale(1.1); }
  .qty-btn:active { box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light); transform: scale(0.95); }
  
  #numEmpleados { width: 45px; text-align: center; border: none; font-size: 18px; font-weight: 700; background: transparent; color: #333; font-family: 'Montserrat', sans-serif;}

  .total-display {
    font-size: 50px; font-weight: 800; text-align: right; margin-top: 50px; color: #222; letter-spacing: -2px;
    text-shadow: 2px 2px 4px rgba(255,255,255,0.5);
  }
  .total-label { font-size: 12px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 3px;}
  .subtotal-note { text-align: right; font-size: 12px; color: #aaa; margin-bottom: 50px; font-style: italic; }

  /* FORMULARIO */
  .form-section { margin-top: 50px; padding-top: 50px; border-top: 1px solid #d1d1d1; }
  .form-title { font-size: 18px; font-weight: 800; margin-bottom: 25px; text-transform: uppercase; color: #444; letter-spacing: 1px;}
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }
  
  .form-input, .form-select {
    width: 100%; padding: 18px; border-radius: 20px; border: none; background: var(--bg-color);
    box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
    color: #333; font-size: 14px; outline: none; box-sizing: border-box; font-family: 'Montserrat', sans-serif;
    transition: box-shadow 0.3s;
  }
  .form-input:focus, .form-select:focus {
    box-shadow: inset 8px 8px 15px var(--shadow-dark), inset -8px -8px 15px var(--shadow-light);
  }

  /* CALENDARIO */
  .custom-calendar {
    background: var(--bg-color); border-radius: 30px; padding: 30px;
    box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
    margin-bottom: 30px;
  }
  .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .month-label { font-weight: 800; text-transform: uppercase; color: #333; letter-spacing: 1px;}
  
  .cal-nav {
    background: var(--bg-color); border: none; cursor: pointer; width: 40px; height: 40px;
    border-radius: 50%; box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
    font-weight: bold; color: #555; transition: transform 0.2s;
  }
  .cal-nav:hover { transform: scale(1.1); }
  .cal-nav:active { box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); }

  .calendar-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); margin-bottom: 15px; text-align: center; font-size: 12px; font-weight: 800; color: #999; }
  .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
  
  .day-cell {
    height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 12px;
    cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s; color: #555;
  }
  .day-cell:hover:not(.disabled):not(.selected) {
    background: #e0e0e0;
    transform: translateY(-2px);
  }
  .day-cell.selected {
    background: var(--bg-color); color: #000;
    box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
    font-weight: 800;
  }
  .day-cell.disabled { color: #ccc; cursor: not-allowed; }

  .time-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; margin-top: 20px; }
  .time-btn {
    padding: 12px; border-radius: 15px; background: var(--bg-color); border: none; cursor: pointer;
    font-size: 13px; font-weight: 600; color: #666; font-family: 'Montserrat', sans-serif;
    box-shadow: 5px 5px 10px var(--shadow-dark), -5px -5px 10px var(--shadow-light);
    transition: all 0.3s;
  }
  .time-btn:hover { transform: translateY(-3px); color: #000; }
  .time-btn.selected {
    background: var(--bg-color); color: #000;
    box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
    border: 1px solid transparent; transform: translateY(0);
  }

  .full-width { grid-column: span 2; }
  @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } .full-width { grid-column: span 1; } }

  .action-buttons { display: flex; flex-direction: column; align-items: center; gap: 25px; margin-top: 60px; }
  
  .btn-whatsapp-big {
    padding: 22px 70px; text-decoration: none; font-weight: 800; text-transform: uppercase;
    font-size: 15px; letter-spacing: 1.5px; cursor: pointer; border-radius: 60px;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex; align-items: center; gap: 15px;
    background-color: var(--bg-color); color: #25D366;
    box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
    border: 1px solid rgba(255,255,255,0.5);
  }
  .btn-whatsapp-big:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 15px 15px 30px var(--shadow-dark), -15px -15px 30px var(--shadow-light);
    color: #1ebc57;
  }

  .hidden { display: none !important; }
  
  /* ANIMACIONES */
  @keyframes fadeInDown { from { opacity: 0; transform: translateY(-40px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes slideUpFade { from { opacity: 0; transform: translateY(60px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
  @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
  @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
</style>
</head>
<body>

<div class="dafic-pricing-container">
  <div class="dafic-logo-wrapper"><img src="COTIZADOR/logo.png" alt="DAFIC" class="dafic-logo-img"></div>
  
  <div class="dafic-toggle-wrapper">
    <button class="dafic-toggle-btn" onclick="cambiarTipo('fisica', this)">Persona FÃ­sica</button>
    <button class="dafic-toggle-btn" onclick="cambiarTipo('moral', this)">Persona Moral</button>
  </div>

  <div id="mensaje-inicial" class="selection-instruction">Seleccione su perfil para visualizar las propuestas</div>

  <div id="grid-fisica" class="dafic-cards-grid hidden">
    <div class="dafic-card" onclick="seleccionarPlan(this, 600, 'RESICO', 1000)"><div class="card-check-icon"></div><div class="card-title">RÃ©gimen Simplificado</div><span class="card-price-range">$600 - $2,000</span><p class="card-desc">Ideal para emprendedores y ventas al pÃºblico.</p></div>
    <div class="dafic-card" onclick="seleccionarPlan(this, 1200, 'Act. Empresarial', 1000)"><div class="card-check-icon"></div><div class="card-title">Actividad Empresarial</div><span class="card-price-range">$1,200 - $6,000</span><p class="card-desc">Profesionales independientes y negocios.</p></div>
    <div class="dafic-card" onclick="seleccionarPlan(this, 1000, 'Plataformas', 1000)"><div class="card-check-icon"></div><div class="card-title">Plataformas Digitales</div><span class="card-price-range">$1,000 - $7,000</span><p class="card-desc">Uber, Airbnb, Amazon, Mercado Libre.</p></div>
    <div class="dafic-card" onclick="seleccionarPlan(this, 1000, 'Arrendamiento', 1000)"><div class="card-check-icon"></div><div class="card-title">Arrendamiento</div><span class="card-price-range">$1,000 - $9,000</span><p class="card-desc">GestiÃ³n fiscal para renta de inmuebles.</p></div>
  </div>

  <div id="grid-moral" class="dafic-cards-grid hidden">
    <div class="dafic-card" onclick="seleccionarPlan(this, 3000, 'Persona Moral Pyme', 2000)"><div class="card-check-icon"></div><div class="card-title">Contabilidad Pyme</div><span class="card-price-range">$3,000 - $30,000</span><p class="card-desc">Cumplimiento total para Sociedades.</p></div>
    <div class="dafic-card" onclick="seleccionarPlan(this, 7000, 'Estrategia Fiscal', 2000)"><div class="card-check-icon"></div><div class="card-title">Estrategia Fiscal</div><span class="card-price-range">$7,000 - $35,000</span><p class="card-desc">ReingenierÃ­a fiscal y optimizaciÃ³n.</p></div>
  </div>

  <div id="zona-calculadora" class="calculator-section">
    <div class="calc-header">Resumen: <strong><span id="nombre-plan-display">---</span></strong></div>

    <div class="calc-option-card active" id="card-diagnostico" onclick="toggleOption('checkDiagnostico', 'card-diagnostico')">
      <div style="display:flex; align-items:center;"><div class="option-indicator"></div><div class="option-content"><span class="option-title">DiagnÃ³stico Inicial</span><span class="option-subtitle">Pago Ãºnico (Bonificable 100%)</span></div></div>
      <div class="option-price">+ $<span id="costo-diagnostico">0</span></div>
      <input type="checkbox" id="checkDiagnostico" style="display:none;" checked>
    </div>

    <div class="calc-option-card" id="card-nomina" onclick="toggleOption('checkNomina', 'card-nomina')">
      <div style="display:flex; align-items:center;"><div class="option-indicator"></div><div class="option-content"><span class="option-title">NÃ³mina / Empleados</span><span class="option-subtitle">Â¿Tienes personal? ($30 c/u)</span></div></div>
      <div id="wrapper-contador" class="qty-control" onclick="event.stopPropagation()"><button class="qty-btn" onclick="cambiarEmpleados(-1)">-</button><input type="number" id="numEmpleados" value="1" readonly><button class="qty-btn" onclick="cambiarEmpleados(1)">+</button></div>
      <div class="option-price">+ $<span id="costo-nomina">0</span></div>
      <input type="checkbox" id="checkNomina" style="display:none;">
    </div>

    <div class="total-display"><span class="total-label">InversiÃ³n Mensual Estimada</span><br>$<span id="total-final">0</span> MXN</div>
    <div id="nota-diagnostico" class="subtotal-note">* El costo del DiagnÃ³stico ($<span id="txt-diag-note">0</span>) es pago Ãºnico.</div>

    <div class="form-section">
      <div class="form-title">InformaciÃ³n para tu Cita</div>
      <div class="form-grid">
        <input type="text" id="clientName" class="form-input" placeholder="Nombre Completo" oninput="actualizarLinks()">
        <input type="text" id="clientGiro" class="form-input" placeholder="Giro del Negocio" oninput="actualizarLinks()">
        <select id="clientStatus" class="form-select" onchange="verificarStatus()">
          <option value="" disabled selected>Â¿EstÃ¡s dado de alta en el SAT?</option>
          <option value="No">No, aÃºn no</option>
          <option value="Si">SÃ­, ya estoy dado de alta</option>
        </select>
        <div id="divAtraso" style="display:none;">
          <select id="clientAtraso" class="form-select" onchange="actualizarLinks()">
            <option value="" disabled selected>Â¿Tienes meses de atraso?</option>
            <option value="Sin Atraso">No, voy al corriente</option>
            <option value="Con Atraso">SÃ­, tengo declaraciones pendientes</option>
          </select>
        </div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-title">Agenda tu Cita (Lun-Sab | 6:30PM - 11:30PM)</div>
      <div class="custom-calendar">
        <div class="calendar-header"><button class="cal-nav" onclick="prevMonth()"><</button><span class="month-label" id="calendar-month-year"></span><button class="cal-nav" onclick="nextMonth()">></button></div>
        <div class="calendar-weekdays"><div>Do</div><div>Lu</div><div>Ma</div><div>Mi</div><div>Ju</div><div>Vi</div><div>Sa</div></div>
        <div class="calendar-days" id="calendar-days"></div>
      </div>
      <label style="font-size:12px; font-weight:bold; color:#777; display:block; text-transform:uppercase; letter-spacing:1px;">Hora Seleccionada: <span id="txt-hora-sel" style="color:#000;">--</span></label>
      <div class="time-grid" id="timeGrid">
        <button class="time-btn" onclick="seleccionarHora('18:30', this)">06:30 PM</button>
        <button class="time-btn" onclick="seleccionarHora('19:00', this)">07:00 PM</button>
        <button class="time-btn" onclick="seleccionarHora('19:30', this)">07:30 PM</button>
        <button class="time-btn" onclick="seleccionarHora('20:00', this)">08:00 PM</button>
        <button class="time-btn" onclick="seleccionarHora('20:30', this)">08:30 PM</button>
        <button class="time-btn" onclick="seleccionarHora('21:00', this)">09:00 PM</button>
        <button class="time-btn" onclick="seleccionarHora('21:30', this)">09:30 PM</button>
        <button class="time-btn" onclick="seleccionarHora('22:00', this)">10:00 PM</button>
        <button class="time-btn" onclick="seleccionarHora('22:30', this)">10:30 PM</button>
        <button class="time-btn" onclick="seleccionarHora('23:00', this)">11:00 PM</button>
        <button class="time-btn" onclick="seleccionarHora('23:30', this)">11:30 PM</button>
      </div>
    </div>

    <div class="action-buttons">
      <a href="#" id="btn-whatsapp-link" target="_blank" class="btn-whatsapp-big">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.664-.698c.969.591 1.746.864 2.792.864 3.19 0 5.775-2.586 5.775-5.766.001-3.18-2.587-5.767-5.771-5.767zm12 5.766c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-4.586 3.193c-.237-.118-1.402-.693-1.619-.772-.217-.079-.375-.118-.533.118-.158.237-.612.772-.75.93-.138.157-.276.177-.513.059-.237-.118-1.002-.37-1.908-1.177-.704-.627-1.18-1.401-1.318-1.637-.138-.237-.007-.365.112-.483.107-.107.237-.276.355-.414.118-.138.158-.237.237-.394.079-.158.04-.296-.02-.414-.059-.118-.533-1.286-.73-1.761-.192-.464-.386-.401-.533-.408-.138-.007-.296-.007-.454-.007-.158 0-.414.059-.632.296-.217.237-.829.809-.829 1.974 0 1.165.849 2.29 .967 2.448.118.157 1.671 2.551 4.049 3.577.566.244 1.008.391 1.353.501.572.181 1.093.155 1.505.094.461-.068 1.402-.573 1.6-1.127.198-.553.198-1.028.139-1.127-.059-.099-.217-.158-.454-.277z"/></svg>
        Confirmar Cita por WhatsApp
      </a>
      
      <a href="#" id="btn-calendar-link" target="_blank" class="btn-calendar" style="display:none; text-decoration:none; color:#555; font-size:13px; font-weight:600; align-items:center; gap:10px; margin-top:10px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-7 5h5v5h-5z"/></svg>
        Agregar a Google Calendar
      </a>
    </div>
  </div>
</div>

<script>
  let precioPlanBase = 0;
  let nombrePlan = "";
  let baseDiagnostico = 0;
  let horaSeleccionada = "";
  let fechaSeleccionada = "";
  let fechaObjeto = null;

  /* CALENDARIO LOGIC */
  const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
  let currentDate = new Date();
  let currMonth = currentDate.getMonth();
  let currYear = currentDate.getFullYear();

  function renderCalendar() {
    const firstDay = new Date(currYear, currMonth, 1).getDay(); 
    const daysInMonth = new Date(currYear, currMonth + 1, 0).getDate();
    const calendarDays = document.getElementById('calendar-days');
    document.getElementById('calendar-month-year').innerText = `${monthNames[currMonth]} ${currYear}`;
    calendarDays.innerHTML = "";

    for (let i = 0; i < firstDay; i++) { calendarDays.appendChild(document.createElement('div')); }

    for (let i = 1; i <= daysInMonth; i++) {
        let dayDiv = document.createElement('div');
        dayDiv.innerText = i; dayDiv.classList.add('day-cell');
        let checkDate = new Date(currYear, currMonth, i);
        if (checkDate.getDay() === 0) dayDiv.classList.add('disabled');
        else dayDiv.onclick = function() { seleccionarFecha(i, this); };
        calendarDays.appendChild(dayDiv);
    }
  }
  function prevMonth() { currMonth--; if(currMonth < 0) { currMonth = 11; currYear--; } renderCalendar(); }
  function nextMonth() { currMonth++; if(currMonth > 11) { currMonth = 0; currYear++; } renderCalendar(); }

  function seleccionarFecha(dia, elemento) {
    document.querySelectorAll('.day-cell').forEach(d => d.classList.remove('selected'));
    elemento.classList.add('selected');
    fechaSeleccionada = `${dia} de ${monthNames[currMonth]} ${currYear}`;
    fechaObjeto = new Date(currYear, currMonth, dia);
    actualizarLinks();
  }
  renderCalendar();

  function cambiarTipo(tipo, btn) {
    document.getElementById('mensaje-inicial').style.display = 'none';
    document.getElementById('zona-calculadora').style.display = 'none';
    resetearSeleccion();
    document.getElementById('grid-fisica').classList.add('hidden');
    document.getElementById('grid-moral').classList.add('hidden');
    if (tipo === 'fisica') document.getElementById('grid-fisica').classList.remove('hidden');
    else document.getElementById('grid-moral').classList.remove('hidden');
    document.querySelectorAll('.dafic-toggle-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }

  function seleccionarPlan(ele, prec, nom, diag) {
    document.querySelectorAll('.dafic-card').forEach(c => c.classList.remove('selected'));
    ele.classList.add('selected');
    precioPlanBase = prec; nombrePlan = nom; baseDiagnostico = diag; 
    document.getElementById('checkDiagnostico').checked = true;
    document.getElementById('card-diagnostico').classList.add('active');
    document.getElementById('checkNomina').checked = false;
    document.getElementById('card-nomina').classList.remove('active');
    updateNominaVisibility();
    document.getElementById('zona-calculadora').style.display = 'block';
    setTimeout(() => { document.getElementById('zona-calculadora').scrollIntoView({behavior: "smooth", block: "center"}); }, 100);
    calcularTotal();
  }

  function toggleOption(chkId, cardId) {
    let chk = document.getElementById(chkId);
    let card = document.getElementById(cardId);
    chk.checked = !chk.checked;
    if (chk.checked) card.classList.add('active'); else card.classList.remove('active');
    if(chkId === 'checkNomina') updateNominaVisibility();
    calcularTotal();
  }

  function updateNominaVisibility() {
    let chk = document.getElementById('checkNomina');
    let wrp = document.getElementById('wrapper-contador');
    if (chk.checked) wrp.classList.add('visible'); else wrp.classList.remove('visible');
  }

  function cambiarEmpleados(delta) {
    let input = document.getElementById('numEmpleados');
    let val = parseInt(input.value) + delta;
    if (val < 1) val = 1; input.value = val; calcularTotal();
  }

  function resetearSeleccion() { precioPlanBase = 0; nombrePlan = ""; baseDiagnostico = 0; document.querySelectorAll('.dafic-card').forEach(c => c.classList.remove('selected')); }

  function verificarStatus() {
    let st = document.getElementById('clientStatus').value;
    let div = document.getElementById('divAtraso');
    if (st === 'Si') div.style.display = 'block';
    else { div.style.display = 'none'; document.getElementById('clientAtraso').value = ""; }
    actualizarLinks();
  }

  function seleccionarHora(hora, btn) {
    horaSeleccionada = hora;
    document.getElementById('txt-hora-sel').innerText = formatTime(hora);
    let btns = document.querySelectorAll('.time-btn');
    btns.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    document.getElementById('btn-calendar-link').style.display = "inline-flex";
    actualizarLinks();
  }
  
  function formatTime(time24) {
    let [h, m] = time24.split(':');
    let ampm = h >= 12 ? 'PM' : 'AM';
    h = h % 12; h = h ? h : 12; 
    return `${h}:${m} ${ampm}`;
  }

  function calcularTotal() {
    let chkDiag = document.getElementById('checkDiagnostico');
    let montoDiag = chkDiag.checked ? baseDiagnostico : 0;
    document.getElementById('costo-diagnostico').innerText = montoDiag.toLocaleString();
    let nota = document.getElementById('nota-diagnostico');
    if(chkDiag.checked) { nota.style.display = 'block'; document.getElementById('txt-diag-note').innerText = montoDiag.toLocaleString(); }
    else nota.style.display = 'none';

    let chkNom = document.getElementById('checkNomina');
    let num = parseInt(document.getElementById('numEmpleados').value);
    let totalNom = chkNom.checked ? num * 30 : 0;
    document.getElementById('costo-nomina').innerText = totalNom.toLocaleString();

    let granTotal = precioPlanBase + totalNom;
    document.getElementById('total-final').innerText = granTotal.toLocaleString();
    document.getElementById('nombre-plan-display').innerText = nombrePlan;
    actualizarLinks();
  }

  function actualizarLinks() {
    let totalMensual = document.getElementById('total-final').innerText;
    let costoDiag = document.getElementById('costo-diagnostico').innerText;
    let empleados = document.getElementById('checkNomina').checked ? document.getElementById('numEmpleados').value : 0;
    let nombre = document.getElementById('clientName').value || "No especificado";
    let giro = document.getElementById('clientGiro').value || "No especificado";
    let status = document.getElementById('clientStatus').value || "No especificado";
    let atraso = document.getElementById('clientAtraso').value;
    
    let infoFiscal = status === 'Si' ? `â€¢ Alta SAT: SÃ\nâ€¢ Estatus: ${atraso || "Sin especificar"}` : `â€¢ Alta SAT: ${status}`;
    let fechaTxt = fechaSeleccionada || "Pendiente";
    let horaTxt = horaSeleccionada ? formatTime(horaSeleccionada) : "Pendiente";

    // LINK WHATSAPP
    let telefono = "5213329780881"; 
    let textoEmpleados = empleados > 0 ? ` (+ NÃ³mina de ${empleados} empleados)` : "";
    let textoDiag = document.getElementById('checkDiagnostico').checked ? `\nâ€¢ DiagnÃ³stico Inicial: $${costoDiag} (Pago Ãšnico)` : "";
    
    let mensaje = `Hola DAFIC, quiero agendar mi cita.\n\n` +
                  `ðŸ“‹ *DATOS DEL CLIENTE*\nâ€¢ Nombre: ${nombre}\nâ€¢ Giro: ${giro}\n${infoFiscal}\n\n` +
                  `ðŸ“Š *COTIZACIÃ“N*\nâ€¢ Plan: ${nombrePlan}\nâ€¢ Mensualidad: $${totalMensual}${textoEmpleados}${textoDiag}\n\n` +
                  `ðŸ“… *CITA SOLICITADA*\nâ€¢ Fecha: ${fechaTxt}\nâ€¢ Hora: ${horaTxt}`;

    document.getElementById('btn-whatsapp-link').href = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;

    // LINK GOOGLE CALENDAR
    if(fechaObjeto && horaSeleccionada) {
      let y = fechaObjeto.getFullYear();
      let m = (fechaObjeto.getMonth()+1).toString().padStart(2, '0');
      let d = fechaObjeto.getDate().toString().padStart(2, '0');
      let [hh, mm] = horaSeleccionada.split(':');
      let startStr = `${y}${m}${d}T${hh}${mm}00`;
      let endH = parseInt(hh) + 1; 
      let endStr = `${y}${m}${d}T${endH.toString().padStart(2,'0')}${mm}00`;
      let details = `Cita con DAFIC\nPlan: ${nombrePlan}\nCliente: ${nombre}`;
      let gcalLink = `https://www.google.com/calendar/render?action=TEMPLATE&text=Cita+DAFIC&dates=${startStr}/${endStr}&details=${encodeURIComponent(details)}&location=Google+Meet+(Pendiente+de+Link)`;
      document.getElementById('btn-calendar-link').href = gcalLink;
    }
  }
</script>
</body>
</html>
