<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Cotizador DAFIC | Ultra Premium</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
  /* --- VARIABLES (MODO CLARO POR DEFECTO) --- */
  :root {
    --bg-color: #e6e6e6;
    --text-main: #333;
    --text-light: #777;
    --card-bg: #e6e6e6;
    
    /* Neumorfismo Claro */
    --shadow-light: rgba(255, 255, 255, 0.9);
    --shadow-dark: rgba(163, 177, 198, 0.6);
    
    --accent-color: #1a1a1a; 
    --green-whatsapp: #25D366;
    --promo-red: #d32f2f;
    --discount-green: #2E7D32;
    --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
    
    /* Sticky Bar */
    --sticky-bg: rgba(255, 255, 255, 0.85);
    --sticky-text: #333;
  }

  /* --- MODO OSCURO AUTOMTICO (SYSTEM PREFERENCE) --- */
  @media (prefers-color-scheme: dark) {
    :root {
      --bg-color: #212429; /* Gris oscuro elegante */
      --text-main: #e0e0e0;
      --text-light: #a0a0a0;
      --card-bg: #212429;

      /* Neumorfismo Oscuro (Sombras invertidas) */
      --shadow-light: rgba(255, 255, 255, 0.06); 
      --shadow-dark: rgba(0, 0, 0, 0.6); 

      --accent-color: #ffffff; /* El acento pasa a blanco para contraste */
      --sticky-bg: rgba(33, 36, 41, 0.9);
      --sticky-text: #fff;
    }
    /* Ajuste de fondo para modo oscuro */
    body { background-image: none !important; } 
    /* El logo deber铆a tener un filtro o ser blanco en PNG, aplicamos brillo */
    .dafic-logo { filter: brightness(1.2) drop-shadow(0 0 10px rgba(255,255,255,0.1)); }
  }

  /* --- ESTILOS GENERALES --- */
  body {
    background-color: var(--bg-color);
    margin: 0;
    font-family: 'Montserrat', sans-serif;
    color: var(--text-main);
    -webkit-font-smoothing: antialiased;
    padding-bottom: 120px; /* Espacio extra para Sticky Bar */
    transition: background-color 0.5s ease;
    /* Textura ruido solo en light mode se ve bien, en dark se quita via media query */
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.04'/%3E%3C/svg%3E");
  }

  .dafic-container {
    max-width: 1100px; margin: 0 auto; text-align: center; padding: 60px 20px;
  }

  .dafic-logo {
    max-width: 240px; margin-bottom: 50px; display: block; margin-left: auto; margin-right: auto;
    transition: transform 0.5s var(--ease-elastic);
  }
  .dafic-logo:hover { transform: scale(1.05); }

  /* --- MIXINS NEUMORFISMO --- */
  .neumo-out {
    background: var(--card-bg);
    box-shadow: 9px 9px 18px var(--shadow-dark), -9px -9px 18px var(--shadow-light);
    border-radius: 25px; border: 1px solid rgba(255,255,255,0.05);
  }

  /* --- TOGGLE --- */
  .toggle-wrapper {
    display: inline-flex; padding: 6px; border-radius: 50px; gap: 10px; margin-bottom: 40px;
    box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
  }
  .toggle-btn {
    padding: 14px 35px; border: none; background: transparent; cursor: pointer;
    font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 12px;
    color: var(--text-light); border-radius: 40px; transition: all 0.4s ease;
    text-transform: uppercase; letter-spacing: 1px;
  }
  .toggle-btn.active {
    background: var(--bg-color); color: var(--accent-color);
    box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    transform: scale(1.05);
  }

  /* --- CARDS --- */
  .cards-grid { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-bottom: 60px; }
  
  .card {
    width: 260px; padding: 45px 25px 35px 25px; text-align: left; cursor: pointer; position: relative;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); opacity: 0; animation: cardEnter 0.6s forwards;
    border-radius: 25px;
  }
  .card:nth-child(1) { animation-delay: 0.05s; }
  .card:nth-child(2) { animation-delay: 0.1s; }
  .card:nth-child(3) { animation-delay: 0.15s; }
  .card:nth-child(4) { animation-delay: 0.2s; }

  .cards-grid.has-selection .card:not(.selected) { opacity: 0.5; transform: scale(0.95); filter: grayscale(1); }
  .card:hover:not(.selected) { transform: translateY(-8px); z-index: 5; }
  
  /* ESTADO SELECCIONADO (INSET/HUNDIDO) */
  .card.selected {
    transform: scale(0.98);
    box-shadow: inset 8px 8px 16px var(--shadow-dark), inset -8px -8px 16px var(--shadow-light);
    border: 1px solid rgba(255,255,255,0.05); z-index: 10;
  }

  .card-icon-container {
    position: absolute; top: 25px; right: 25px; width: 30px; height: 30px;
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
    transition: 0.3s;
  }
  .card.selected .card-icon-container {
    box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light);
    transform: scale(0.9);
  }
  .checkmark-svg { width: 14px; height: 14px; stroke: var(--accent-color); stroke-width: 3; fill: none; stroke-linecap: round; stroke-dasharray: 20; stroke-dashoffset: 20; transition: stroke-dashoffset 0.4s ease 0.2s; }
  .card.selected .checkmark-svg { stroke-dashoffset: 0; }

  .card h3 { font-size: 11px; text-transform: uppercase; color: var(--text-light); letter-spacing: 2px; margin: 15px 0 10px 0; font-weight: 700; }
  .card .price { font-size: 20px; font-weight: 800; color: var(--text-main); display: block; margin-bottom: 12px; letter-spacing: -0.5px;}
  .card p { font-size: 12px; color: var(--text-light); line-height: 1.6; font-weight: 500; margin: 0; }
  .card small { display: block; font-size: 10px; margin-top: 5px; color: var(--promo-red); font-weight: 700; text-transform: uppercase; }

  .badge {
    position: absolute; top: 0; left: 50%; transform: translateX(-50%);
    font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px;
    padding: 6px 18px; border-radius: 0 0 12px 12px; color: white;
    box-shadow: 0 5px 10px rgba(0,0,0,0.15); z-index: 3;
  }

  /* --- CALCULADORA --- */
  .calc-section {
    max-width: 850px; margin: 0 auto; padding: 50px; text-align: left; display: none;
    animation: slideUp 0.6s ease;
    /* Glassmorphism compatible con dark mode */
    background: var(--bg-color);
    border: 1px solid rgba(255,255,255,0.05);
  }
  
  .calc-header { 
    display: flex; justify-content: space-between; align-items: baseline; 
    margin-bottom: 40px; border-bottom: 1px solid var(--text-light); padding-bottom: 20px; opacity: 0.5;
  }
  .calc-header h2 { font-size: 22px; font-weight: 300; margin: 0; color: var(--text-main); }
  .calc-header strong { font-weight: 800; color: var(--accent-color); font-size: 24px; }

  /* Filas de opciones */
  .option-row {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;
    padding: 25px 30px; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent;
  }
  .option-row:hover { transform: scale(1.01); }
  /* Estado Activo: Hundido */
  .option-row.active { 
    box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
    border-radius: 20px;
  }
  
  .check-circle {
    width: 24px; height: 24px; border-radius: 50%; margin-right: 20px;
    box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
    display: flex; align-items: center; justify-content: center; transition: 0.3s;
  }
  .option-row.active .check-circle { box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light); }
  .mini-check { width: 12px; height: 12px; stroke: var(--accent-color); stroke-width: 3; fill: none; transition: stroke 0.3s; stroke-dasharray: 20; stroke-dashoffset: 20; }
  .option-row.active .mini-check { stroke-dashoffset: 0; }

  /* SELECTOR */
  .custom-select-wrapper { position: relative; user-select: none; width: 100%; transition: 0.3s; }
  .custom-select-trigger {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 20px; font-size: 14px; font-weight: 600; color: var(--text-main); cursor: pointer;
    background: var(--bg-color); border-radius: 15px;
    /* Hundido por defecto */
    box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
    transition: all 0.3s;
  }
  .arrow { width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 6px solid var(--text-light); transition: 0.3s; }
  .custom-select-wrapper.open .arrow { transform: rotate(180deg); }

  .custom-options {
    position: absolute; top: 110%; left: 0; right: 0; z-index: 100;
    background: var(--bg-color); border-radius: 15px; overflow: hidden;
    box-shadow: 10px 10px 30px rgba(0,0,0,0.3);
    opacity: 0; visibility: hidden; transform: translateY(-10px); transition: all 0.3s;
  }
  .custom-select-wrapper.open .custom-options { opacity: 1; visibility: visible; transform: translateY(0); }
  .custom-option {
    padding: 15px 20px; font-size: 14px; font-weight: 500; color: var(--text-main); cursor: pointer;
    transition: 0.2s; border-bottom: 1px solid rgba(0,0,0,0.05);
  }
  .custom-option:hover { background: var(--accent-color); color: var(--bg-color); }

  /* CONTROLES CANTIDAD */
  .qty-capsule {
    display: flex; align-items: center; gap: 0; 
    padding: 5px; border-radius: 30px; margin-left: auto; margin-right: 20px;
    box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
    visibility: hidden; opacity: 0; transition: 0.3s;
  }
  .qty-capsule.visible { visibility: visible; opacity: 1; }

  .qty-btn {
    width: 32px; height: 32px; border-radius: 50%; border: none; cursor: pointer;
    background: var(--bg-color); color: var(--text-main); font-weight: bold; font-size: 18px;
    box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
    display: flex; align-items: center; justify-content: center; transition: 0.2s;
  }
  .qty-btn:active { box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light); transform: scale(0.95); }
  .qty-val { width: 40px; text-align: center; border: none; background: transparent; font-weight: 700; font-size: 16px; color: var(--text-main); }

  /* --- FORMULARIO --- */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 40px; }
  .lux-input {
    width: 100%; padding: 18px 20px; border-radius: 15px; border: none; outline: none;
    box-shadow: inset 6px 6px 12px var(--shadow-dark), inset -6px -6px 12px var(--shadow-light);
    background: var(--bg-color); font-family: 'Montserrat', sans-serif; font-size: 14px; color: var(--text-main); font-weight: 600;
    box-sizing: border-box; transition: all 0.3s ease;
  }
  .lux-input:focus { box-shadow: inset 8px 8px 16px var(--shadow-dark), inset -8px -8px 16px var(--shadow-light); }

  /* --- CALENDARIO (DAS CPSULA HUNDIDA) --- */
  .calendar-card {
    padding: 40px; margin-top: 40px; border-radius: 30px;
    background: var(--bg-color);
    box-shadow: 12px 12px 24px var(--shadow-dark), -12px -12px 24px var(--shadow-light);
  }
  .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; font-weight: 800; text-transform: uppercase; color: var(--text-main); }
  
  .cal-btn {
    width: 40px; height: 40px; border-radius: 50%; border: none; background: var(--bg-color); cursor: pointer;
    box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    font-weight: bold; color: var(--text-light); display: flex; align-items: center; justify-content: center; transition: 0.3s;
  }
  .cal-btn:active { box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); transform: scale(0.95); }

  .cal-weekdays, .cal-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; text-align: center; }
  .cal-weekdays { font-size: 11px; font-weight: 700; color: var(--text-light); margin-bottom: 15px; }
  
  /* ESTILO DA CPSULA */
  .day {
    height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-light); transition: 0.2s;
  }
  .day:hover:not(.empty):not(.selected):not(.disabled) { background: rgba(128,128,128,0.1); }
  
  .day.selected {
    background: var(--bg-color); color: var(--accent-color);
    box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
    font-weight: 900; transform: scale(0.95); border-radius: 15px;
    border: 1px solid rgba(255,255,255,0.05);
  }
  .day.disabled { opacity: 0.2; cursor: default; }
  
  /* GRID HORAS (CPSULA PRESIONADA) */
  .hours-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 15px; margin-top: 35px; opacity: 0; animation: fadeIn 0.5s forwards 0.2s; }
  .hour-btn {
    padding: 12px; border-radius: 15px; border: none; background: var(--bg-color); cursor: pointer;
    box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
    font-size: 13px; font-weight: 600; color: var(--text-light); transition: 0.2s;
  }
  .hour-btn:hover { transform: translateY(-2px); }
  
  .hour-btn.selected {
    box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);
    color: var(--accent-color); font-weight: 900; transform: scale(0.95);
  }

  /* --- BOTN FINAL (VERDE AL HOVER) --- */
  .action-area { margin-top: 60px; text-align: center; }
  .total-big { font-size: 60px; font-weight: 800; margin-bottom: 5px; display: block; letter-spacing: -3px; color: var(--text-main); }
  .iva-label { font-size: 12px; color: var(--text-light); font-weight: 600; letter-spacing: 2px; display: block; margin-bottom: 40px; text-transform: uppercase; }
  
  .btn-confirm {
    padding: 22px 85px; border-radius: 60px; text-decoration: none; font-weight: 800; letter-spacing: 2px;
    text-transform: uppercase; font-size: 15px; color: var(--text-main); border: none; cursor: pointer;
    background: var(--bg-color);
    box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
    transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); 
    display: inline-flex; align-items: center; gap: 12px;
    position: relative; overflow: hidden; z-index: 1;
  }
  
  .btn-confirm::before {
    content: ''; position: absolute; top: 0; left: 0; width: 0%; height: 100%;
    background: var(--green-whatsapp); transition: width 0.5s var(--ease-elastic); z-index: -1;
  }
  /* En hover cambia texto a blanco y se llena de verde */
  .btn-confirm:hover { color: white; transform: translateY(-5px); box-shadow: 0 15px 30px rgba(37, 211, 102, 0.3); }
  .btn-confirm:hover::before { width: 100%; }

  /* --- STICKY BAR (MOVIL) --- */
  .sticky-bar {
    position: fixed; bottom: 0; left: 0; width: 100%; height: 90px;
    background: var(--sticky-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
    display: none; justify-content: space-between; align-items: center;
    padding: 0 25px; z-index: 999; box-sizing: border-box;
    box-shadow: 0 -10px 30px rgba(0,0,0,0.1); border-top: 1px solid rgba(255,255,255,0.1);
    animation: slideUpSticky 0.5s ease-out;
  }
  .sticky-info { display: flex; flex-direction: column; text-align: left; }
  .sticky-label { font-size: 10px; text-transform: uppercase; color: var(--text-light); letter-spacing: 1px; font-weight: 700; }
  .sticky-total { font-size: 24px; font-weight: 800; color: var(--sticky-text); }
  
  .sticky-btn {
    padding: 15px 30px; border-radius: 40px; border: none; font-weight: 800; font-size: 12px;
    background: var(--green-whatsapp); color: white; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
    box-shadow: 0 5px 15px rgba(37, 211, 102, 0.4);
  }

  @media (max-width: 768px) {
    .sticky-bar { display: flex; }
    .action-area { display: none; } /* Ocultar bot贸n grande en m贸vil */
  }

  /* Validaciones (Shake) */
  .input-error { box-shadow: inset 0 0 0 2px var(--promo-red) !important; animation: shake 0.4s; }
  @keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-5px);} 75%{transform:translateX(5px);} }
  @keyframes cardEnter { from{opacity:0; transform:translateY(40px) scale(0.9);} to{opacity:1; transform:translateY(0) scale(1);} }
  @keyframes slideUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }
  @keyframes slideUpSticky { from{transform:translateY(100%);} to{transform:translateY(0);} }
  @keyframes fadeIn { to { opacity: 1; } }
  .hidden { display: none !important; }
</style>
</head>
<body>

<div class="dafic-container">
  
  <img src="https://raw.githubusercontent.com/DAFICCOMMX/COTIZADOR/main/logo.png" alt="DAFIC" class="dafic-logo" onerror="this.src='COTIZADOR/logo.png'">

  <div class="toggle-wrapper">
    <button class="toggle-btn" onclick="cambiarTipo('fisica', this)">Persona F铆sica</button>
    <button class="toggle-btn" onclick="cambiarTipo('moral', this)">Persona Moral</button>
  </div>

  <div id="instruction" style="font-size:11px; letter-spacing:3px; text-transform:uppercase; color:#999; margin-bottom:10px; animation: fadeIn 2s;">SELECCIONA TU PERFIL</div>

  <div id="grid-fisica" class="cards-grid hidden">
    <div class="card neumo-out" onclick="selectPlan(this, 600, 'RESICO')">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>R茅gimen Simplificado</h3>
      <span class="price">Desde: $600</span>
      <p>Ideal para emprendedores.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 1200, 'Act. Empresarial')">
      <div class="badge" style="background:#222;">Popular</div>
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Actividad Empresarial</h3>
      <span class="price">Desde: $1,200</span>
      <p>Profesionales y negocios.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 1000, 'Plataformas')">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Plataformas Digitales</h3>
      <span class="price">Desde: $1,000</span>
      <p>Uber, Airbnb, Amazon.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 1000, 'Arrendamiento')">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Arrendamiento</h3>
      <span class="price">Desde: $1,000</span>
      <p>Renta de inmuebles.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 1000, 'Declaraci贸n Anual PF', false, true)">
      <div class="badge" style="background:var(--promo-red);">Oferta</div>
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Declaraci贸n Anual</h3>
      <span class="price">$1,000</span>
      <p>Incluye Contrase帽a GRATIS.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 1500, 'Devoluci贸n Impuestos PF', false, true, ' + 15%')">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Devoluci贸n Impuestos</h3>
      <span class="price">$1,500 <small>+ 15% recuperado</small></span>
      <p>Recuperar saldo a favor.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 0, 'Regularizaci贸n Fiscal PF', true)">
      <div class="badge" style="background:var(--discount-green);">Esencial</div>
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Regularizaci贸n</h3>
      <span class="price">Desde: $600</span>
      <p>隆Descuentos por volumen!</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 800, 'Renovaci贸n e.Firma', false, true)">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Renovaci贸n e.Firma</h3>
      <span class="price">$800</span>
      <p>Tr谩mite en l铆nea.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 500, 'Cita SAT', false, true)">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Cita SAT</h3>
      <span class="price">$500</span>
      <p>Agendamos tu cita.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 500, 'Tr谩mite IMSS', false, true)">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Tr谩mite IMSS</h3>
      <span class="price">$500</span>
      <p>Gesti贸n seguridad social.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 200, 'Generaci贸n Contrase帽a', false, true)">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Generar Contrase帽a</h3>
      <span class="price">$200</span>
      <p>Acceso al portal SAT.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 800, 'Asesor铆a 1:1', false, true)">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Asesor铆a 1 a 1</h3>
      <span class="price">$800 <small>POR HORA</small></span>
      <p>Sesi贸n por Zoom.</p>
    </div>
  </div>

  <div id="grid-moral" class="cards-grid hidden">
    <div class="card neumo-out" onclick="selectPlan(this, 3000, 'Contabilidad PM')">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Contabilidad</h3>
      <span class="price">Desde: $3,000</span>
      <p>Cumplimiento total.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 7000, 'Estrategia Fiscal', false, true)">
      <div class="badge" style="background:#000;">Exclusivo</div>
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Estrategia Fiscal</h3>
      <span class="price">Desde: $7,000</span>
      <p>Optimizaci贸n fiscal.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 3500, 'Devoluci贸n Impuestos PM', false, true, ' + 20%')">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Devoluci贸n Impuestos</h3>
      <span class="price">$3,500 <small>+ 20% recuperado</small></span>
      <p>Recuperaci贸n de saldos.</p>
    </div>
    <div class="card neumo-out" onclick="selectPlan(this, 0, 'Regularizaci贸n Fiscal PM', true)">
      <div class="card-icon-container"><svg class="checkmark-svg"><path d="M2 8 l4 4 l8 -8"/></svg></div>
      <h3>Regularizaci贸n</h3>
      <span class="price">Desde: $3,000</span>
      <p>Evita multas.</p>
    </div>
  </div>

  <div id="calculator" class="calc-section neumo-out">
    <div class="calc-header">
      <h2>Resumen</h2>
      <strong><span id="plan-name">---</span></strong>
    </div>

    <div id="row-reg" class="option-row neumo-out" style="display:none; flex-direction: column; align-items: stretch; cursor:default;" onclick="event.stopPropagation()">
      <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:15px;">
        <div style="display:flex; align-items:center;">
          <div class="check-circle"><svg class="mini-check"><path d="M2 6 l3 3 l6 -6"/></svg></div>
          <span style="font-weight:700;">Configurar Atraso</span>
        </div>
      </div>
      
      <div id="regime-select-wrapper" class="custom-select-wrapper">
          <div class="custom-select-trigger" onclick="toggleCustomSelect(this)">
              <span id="regime-text">Selecciona R茅gimen</span>
              <div class="arrow"></div>
          </div>
          <div class="custom-options" id="regime-options"></div>
      </div>
      <input type="hidden" id="regime-value" value="0">

      <div style="display:flex; justify-content: space-between; align-items:center; margin-top:15px;">
        <span id="discount-label" style="font-size:11px; color:var(--discount-green); font-weight:800;"></span>
        <div class="qty-capsule visible">
          <button class="qty-btn" onclick="changeQty('reg', -1)">-</button>
          <input id="qty-reg" class="qty-val" value="1" readonly>
          <button class="qty-btn" onclick="changeQty('reg', 1)">+</button>
        </div>
      </div>
    </div>

    <div id="row-diag" class="option-row neumo-out active" onclick="toggleOption('diag')">
      <div style="display:flex; align-items:center;">
        <div class="check-circle"><svg class="mini-check"><path d="M2 6 l3 3 l6 -6"/></svg></div>
        <div>
          <span style="display:block; font-weight:700; font-size:16px;">Diagn贸stico Inicial</span>
          <span style="font-size:12px; color:var(--text-light);">Pago 煤nico reembolsable</span>
        </div>
      </div>
      <div style="font-weight:700; font-size:18px;">+$<span id="price-diag">0</span></div>
    </div>

    <div id="row-nom" class="option-row neumo-out" onclick="toggleOption('nom')">
      <div style="display:flex; align-items:center;">
        <div class="check-circle"><svg class="mini-check"><path d="M2 6 l3 3 l6 -6"/></svg></div>
        <div>
          <span style="display:block; font-weight:700; font-size:16px;">Empleados / N贸mina</span>
          <span style="font-size:12px; color:var(--text-light);">$30 por empleado</span>
        </div>
      </div>
      <div id="capsule-nom" class="qty-capsule">
        <button class="qty-btn" onclick="changeQty('nom', -1); event.stopPropagation();">-</button>
        <input id="qty-nom" class="qty-val" value="1" readonly>
        <button class="qty-btn" onclick="changeQty('nom', 1); event.stopPropagation();">+</button>
      </div>
      <div style="font-weight:700; min-width:70px; text-align:right; font-size:18px;">+$<span id="price-nom">0</span></div>
    </div>

    <div class="action-area">
      <span style="font-size:12px; letter-spacing:3px; color:var(--text-light); font-weight:600;">INVERSIN ESTIMADA</span>
      <span class="total-big" id="total-display">$0</span>
      <span class="iva-label">(Precios con IVA incluido)</span>
      <span id="txt-extra" style="display:block; color:var(--text-light); margin-top:-30px; margin-bottom:30px; font-weight:600;"></span>
      
      <div class="form-grid">
        <div><input type="text" id="name" class="lux-input" placeholder="Nombre Completo" oninput="updateLink()"></div>
        <div><input type="text" id="giro" class="lux-input" placeholder="Giro del Negocio" oninput="updateLink()"></div>
        
        <div class="custom-select-wrapper" style="grid-column: span 2;">
            <div class="custom-select-trigger" onclick="toggleCustomSelect(this)">
                <span id="status-text">Estatus ante el SAT</span>
                <div class="arrow"></div>
            </div>
            <div class="custom-options">
                <div class="custom-option" onclick="setCustomValue(this, 'status', 'No dado de alta')">No dado de alta</div>
                <div class="custom-option" onclick="setCustomValue(this, 'status', 'Ya dado de alta')">Ya dado de alta</div>
            </div>
            <input type="hidden" id="status-value" value="">
        </div>
      </div>

      <div class="calendar-card neumo-out">
        <div class="cal-header">
          <button class="cal-btn" onclick="navMonth(-1)"><</button>
          <span id="month-label">---</span>
          <button class="cal-btn" onclick="navMonth(1)">></button>
        </div>
        <div class="cal-weekdays"><div>DO</div><div>LU</div><div>MA</div><div>MI</div><div>JU</div><div>VI</div><div>SA</div></div>
        <div id="cal-grid" class="cal-days"></div>
        <div id="hours-grid" class="hours-grid"></div>
      </div>

      <br><br>
      <a href="#" id="wa-link" onclick="validateAndSend(event)" class="btn-confirm">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.664-.698c.969.591 1.746.864 2.792.864 3.19 0 5.775-2.586 5.775-5.766.001-3.18-2.587-5.767-5.771-5.767zm12 5.766c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-4.586 3.193c-.237-.118-1.402-.693-1.619-.772-.217-.079-.375-.118-.533.118-.158.237-.612.772-.75.93-.138.157-.276.177-.513.059-.237-.118-1.002-.37-1.908-1.177-.704-.627-1.18-1.401-1.318-1.637-.138-.237-.007-.365.112-.483.107-.107.237-.276.355-.414.118-.138.158-.237.237-.394.079-.158.04-.296-.02-.414-.059-.118-.533-1.286-.73-1.761-.192-.464-.386-.401-.533-.408-.138-.007-.296-.007-.454-.007-.158 0-.414.059-.632.296-.217.237-.829.809-.829 1.974 0 1.165.849 2.29 .967 2.448.118.157 1.671 2.551 4.049 3.577.566.244 1.008.391 1.353.501.572.181 1.093.155 1.505.094.461-.068 1.402-.573 1.6-1.127.198-.553.198-1.028.139-1.127-.059-.099-.217-.158-.454-.277z"/></svg>
        CONFIRMAR CITA
      </a>
    </div>

  </div>
  
  <div class="sticky-bar">
     <div class="sticky-info">
        <span class="sticky-label">Total Estimado</span>
        <span class="sticky-total" id="sticky-total">$0</span>
     </div>
     <button onclick="validateAndSend(event)" class="sticky-btn">Confirmar</button>
  </div>
</div>

<script>
  let state = {
    planPrice: 0, planName: '', isReg: false, isSimple: false, textExtra: '',
    diagPrice: 1000, diagActive: true,
    nomCount: 1, nomActive: false,
    regMonths: 1, regType: 'fisica', 
    date: null, time: null,
    currDate: new Date(),
    currentTotal: 0
  };

  const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
  
  function cambiarTipo(type, btn) {
    document.getElementById('instruction').style.display = 'none';
    document.getElementById('calculator').style.display = 'none';
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    document.getElementById('grid-fisica').classList.add('hidden');
    document.getElementById('grid-moral').classList.add('hidden');
    
    document.querySelectorAll('.card').forEach(c => { c.classList.remove('selected'); });
    document.querySelectorAll('.cards-grid').forEach(g => g.classList.remove('has-selection'));

    if(type === 'fisica') {
        document.getElementById('grid-fisica').classList.remove('hidden');
        state.regType = 'fisica';
    } else {
        document.getElementById('grid-moral').classList.remove('hidden');
        state.regType = 'moral';
    }
  }

  function selectPlan(card, price, name, isReg = false, isSimple = false, txtExtra = '') {
    let grid = card.parentElement;
    grid.classList.add('has-selection');
    grid.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');

    state.planPrice = price;
    state.planName = name;
    state.isReg = isReg;
    state.isSimple = isSimple; 
    state.textExtra = txtExtra;
    
    state.diagActive = !isSimple && !isReg; 
    state.nomActive = false;
    state.regMonths = 1; document.getElementById('qty-reg').value = 1;

    document.getElementById('plan-name').innerText = name;
    document.getElementById('calculator').style.display = 'block';
    document.getElementById('price-diag').innerText = state.diagPrice.toLocaleString();
    
    let rowReg = document.getElementById('row-reg');
    rowReg.style.display = isReg ? 'flex' : 'none';
    if (isReg) { populateRegimeSelector(state.regType); }

    let showExtras = !isReg && !isSimple;
    document.getElementById('row-diag').style.display = showExtras ? 'flex' : 'none';
    document.getElementById('row-nom').style.display = showExtras ? 'flex' : 'none';

    if(showExtras) document.getElementById('row-diag').classList.add('active');
    document.getElementById('row-nom').classList.remove('active');
    document.getElementById('capsule-nom').classList.remove('visible');

    setTimeout(() => { document.getElementById('calculator').scrollIntoView({behavior:'smooth', block:'center'}); }, 100);
    renderCalendar();
    calcTotal();
  }

  function populateRegimeSelector(type) {
      const wrapper = document.getElementById('regime-options');
      wrapper.innerHTML = "";
      
      let opts = [];
      if (type === 'fisica') {
          opts = [
              {val: 600, txt: "RESICO ($600/mes)"},
              {val: 1200, txt: "Actividad Empresarial ($1,200/mes)"},
              {val: 1000, txt: "Plataformas / Arrendamiento ($1,000/mes)"}
          ];
      } else {
          opts = [
              {val: 3000, txt: "Sociedad Civil / S.A. ($3,000/mes)"},
              {val: 4000, txt: "Otros ($4,000/mes)"}
          ];
      }
      document.getElementById('regime-value').value = opts[0].val;
      document.getElementById('regime-text').innerText = opts[0].txt;

      opts.forEach(op => {
          let div = document.createElement('div');
          div.className = 'custom-option';
          div.innerText = op.txt;
          div.onclick = function() { setCustomValue(this, 'regime', op.val, true); };
          wrapper.appendChild(div);
      });
  }

  function toggleCustomSelect(trigger) {
      let wrapper = trigger.parentElement;
      wrapper.classList.toggle('open');
      document.querySelectorAll('.custom-select-wrapper').forEach(w => { if(w !== wrapper) w.classList.remove('open'); });
  }
  
  function setCustomValue(option, id, val, triggerCalc = false) {
      let wrapper = option.parentElement.parentElement;
      wrapper.querySelector('.custom-select-trigger span').innerText = option.innerText;
      document.getElementById(id + '-value').value = val;
      wrapper.classList.remove('open');
      if(triggerCalc) calcTotal(); else updateLink(); 
  }
  window.addEventListener('click', function(e) {
      if (!e.target.closest('.custom-select-wrapper')) {
          document.querySelectorAll('.custom-select-wrapper').forEach(w => w.classList.remove('open'));
      }
  });

  function toggleOption(opt) {
    if(opt === 'diag') {
      state.diagActive = !state.diagActive;
      let row = document.getElementById('row-diag');
      state.diagActive ? row.classList.add('active') : row.classList.remove('active');
    }
    if(opt === 'nom') {
      state.nomActive = !state.nomActive;
      let row = document.getElementById('row-nom');
      let cap = document.getElementById('capsule-nom');
      if(state.nomActive) { row.classList.add('active'); cap.classList.add('visible'); }
      else { row.classList.remove('active'); cap.classList.remove('visible'); }
    }
    calcTotal();
  }

  function changeQty(type, delta) {
    if(type === 'reg') {
      state.regMonths = Math.max(1, state.regMonths + delta);
      document.getElementById('qty-reg').value = state.regMonths;
    }
    if(type === 'nom') {
      state.nomCount = Math.max(1, state.nomCount + delta);
      document.getElementById('qty-nom').value = state.nomCount;
    }
    calcTotal();
  }

  function animateValue(obj, start, end, duration) {
    let startTimestamp = null;
    const step = (timestamp) => {
      if (!startTimestamp) startTimestamp = timestamp;
      const progress = Math.min((timestamp - startTimestamp) / duration, 1);
      obj.innerHTML = "<b>$" + Math.floor(progress * (end - start) + start).toLocaleString() + "</b>";
      if (progress < 1) window.requestAnimationFrame(step);
    };
    window.requestAnimationFrame(step);
  }

  function calcTotal() {
    let total = 0;
    document.getElementById('discount-label').innerText = "";
    document.getElementById('txt-extra').innerText = "";
    
    if(state.isReg) {
      let baseVal = parseInt(document.getElementById('regime-value').value);
      let sub = baseVal * state.regMonths;
      let discount = 0;
      if(state.regMonths >= 12) discount = 0.30; 
      else if(state.regMonths >= 6) discount = 0.20; 
      else if(state.regMonths >= 3) discount = 0.10; 
      total = sub - (sub * discount);
      if(discount > 0) document.getElementById('discount-label').innerText = `隆${discount*100}% DE DESCUENTO APLICADO!`;
      document.getElementById('txt-extra').innerText = `Regularizaci贸n de ${state.regMonths} meses`;
    } else if(state.isSimple) {
      total = state.planPrice;
      if(state.textExtra) document.getElementById('txt-extra').innerText = state.textExtra;
    } else {
      if(state.diagActive) {
        total = state.diagPrice;
        document.getElementById('txt-extra').innerText = `* Pago Inicial. Mensualidad futura: $${(state.planPrice + (state.nomActive ? state.nomCount*30 : 0)).toLocaleString()}`;
      } else {
        total = state.planPrice;
        if(state.nomActive) total += (state.nomCount * 30);
        document.getElementById('txt-extra').innerText = "Pago Mensual Estimado";
      }
    }
    
    const totalEl = document.getElementById("total-display");
    const stickyEl = document.getElementById("sticky-total");
    animateValue(totalEl, state.currentTotal, total, 500);
    stickyEl.innerText = "$" + total.toLocaleString();
    state.currentTotal = total;

    if(state.nomActive) document.getElementById('price-nom').innerText = (state.nomCount * 30).toLocaleString();
    updateLink();
  }

  function renderCalendar() {
    let y = state.currDate.getFullYear();
    let m = state.currDate.getMonth();
    document.getElementById('month-label').innerText = `${monthNames[m]} ${y}`;
    
    let firstDay = new Date(y, m, 1).getDay();
    let daysInMonth = new Date(y, m + 1, 0).getDate();
    let grid = document.getElementById('cal-grid');
    grid.innerHTML = "";
    
    for(let i=0; i<firstDay; i++) {
      let d = document.createElement('div'); d.className = 'day empty'; grid.appendChild(d);
    }
    let today = new Date();
    for(let i=1; i<=daysInMonth; i++) {
      let d = document.createElement('div'); d.className = 'day'; d.innerText = i;
      let dateCheck = new Date(y, m, i);
      if(dateCheck.getDay() === 0) { d.classList.add('disabled'); } 
      else {
        d.onclick = () => selectDate(i, d);
        if(i === today.getDate() && m === today.getMonth() && y === today.getFullYear()) { selectDate(i, d); }
      }
      grid.appendChild(d);
    }
  }

  function navMonth(delta) {
    state.currDate.setMonth(state.currDate.getMonth() + delta);
    renderCalendar();
  }

  function selectDate(day, el) {
    document.querySelectorAll('.day').forEach(d => d.classList.remove('selected'));
    el.classList.add('selected');
    state.date = `${day} de ${monthNames[state.currDate.getMonth()]}`;
    let dateObj = new Date(state.currDate.getFullYear(), state.currDate.getMonth(), day);
    renderHours(dateObj.getDay());
    updateLink();
  }

  function renderHours(dayOfWeek) {
    let grid = document.getElementById('hours-grid');
    grid.innerHTML = "";
    let slots = (dayOfWeek === 6) 
      ? ['08:00', '08:30', '09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00']
      : ['18:30', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30', '22:00', '22:30', '23:00', '23:30'];
      
    slots.forEach(h => {
      let b = document.createElement('button');
      b.className = 'hour-btn';
      b.innerText = formatTime(h);
      b.onclick = () => {
        document.querySelectorAll('.hour-btn').forEach(x => x.classList.remove('selected'));
        b.classList.add('selected');
        state.time = formatTime(h);
        updateLink();
      };
      grid.appendChild(b);
    });
  }

  function formatTime(t) {
    let [h, m] = t.split(':');
    let ampm = h >= 12 ? 'PM' : 'AM';
    h = h % 12 || 12;
    return `${h}:${m} ${ampm}`;
  }

  function updateLink() {
    let name = document.getElementById('name').value;
    let giro = document.getElementById('giro').value;
    let st = document.getElementById('status-value').value;
    let totalText = document.getElementById('total-display').innerText;
    let regimeTxt = "";
    if (state.isReg) { regimeTxt = " (" + document.querySelector('#regime-select-wrapper span').innerText + ")"; }

    let msg = `Hola DAFIC, quiero agendar mi cita.\n` +
              `--------------------------------\n` +
              ` *CLIENTE*: ${name} (${giro})\n` +
              ` *ESTATUS SAT*: ${st}\n` +
              ` *PLAN*: ${state.planName}${regimeTxt}\n` +
              ` *INVERSIN*: ${totalText}${state.textExtra ? ' ' + state.textExtra : ''}\n\n` +
              ` *CITA*: ${state.date || 'Pendiente'} - ${state.time || '--'}`;
              
    state.whatsappLink = `https://wa.me/5213329780881?text=${encodeURIComponent(msg)}`;
  }

  function validateAndSend(e) {
    e.preventDefault();
    let hasError = false;
    let nameInput = document.getElementById('name');
    let statusInput = document.getElementById('status-value');
    let btn = document.querySelector('.btn-confirm');

    nameInput.classList.remove('input-error');
    document.querySelector('.custom-select-trigger').style.border = "none";

    if(state.planPrice === 0) { alert("Por favor selecciona un servicio primero."); window.scrollTo({top: 0, behavior: 'smooth'}); return; }
    if(!nameInput.value.trim()) { nameInput.classList.add('input-error'); hasError = true; }
    if(!statusInput.value) { document.querySelector('.custom-select-trigger').style.border = "1px solid #d32f2f"; hasError = true; }
    if(!state.date) { document.querySelector('.calendar-card').style.animation = "shake 0.4s ease-in-out"; setTimeout(() => { document.querySelector('.calendar-card').style.animation = ""; }, 400); hasError = true; }

    if(hasError) {
        let originalText = btn.innerHTML;
        btn.innerHTML = "FALTAN DATOS 锔";
        btn.style.background = "#d32f2f";
        setTimeout(() => { btn.innerHTML = originalText; btn.style.background = ""; }, 1500);
        return;
    }
    updateLink();
    window.open(state.whatsappLink, '_blank');
  }
</script>
</body>
</html>
